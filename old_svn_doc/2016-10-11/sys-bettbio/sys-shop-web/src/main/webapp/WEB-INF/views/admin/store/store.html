<%layout("/common/admin/layout.html",{
css:["dropify/css/dropify.min.css"],
script:["dropify/js/dropify.min.js","js/admin/store.js"],
dynscript:"$(document).ready(function(){$.app.initDropify();})"}){ %>
<div class="container-fluid warp">
	<div class="row warp-tabs">
		<ul class="nav nav-tabs">
			 <li class="active"><a href="${ctxPath}/admin/store/store">商家详情</a></li>
			 <li><a href="${ctxPath}/admin/store/create">创建用户</a></li>
			 <li><a href="${ctxPath}/admin/store/userList">商家用户清单</a></li>
			<!-- <li><a href="${ctxPath}/admin/store/logo">商家LOGO</a></li> -->
		</ul>
	</div>
	<% if(has(sucMess)){%>
			<div class="warp-body">
				<div class="alert alert-success">${sucMess}</div>
				<div class="row">
					<ul id="ZT" class="ztree"></ul>
				</div>
			</div>
	<%}%>
	<% if(has(errMess)){%>
			<div class="warp-body">
				<div class="alert alert-danger">${errMess}</div>
				<div class="row">
					<ul id="ZT" class="ztree"></ul>
				</div>
			</div>
	<%}%>
	
	<div class="warp-body">
		<form class="form-horizontal" id="updateForm" enctype="multipart/form-data" action="${ctxPath}/admin/store/update" method="post">
			<div class="row">
				<div class="form-group form-group-lg">
					<div class="col-sm-2">
						<label class="control-label">商家唯一代码</label>
					</div>
					<div class="col-sm-10">
						<label class="control-label">${storeAndUser.storeId!}</label>
						<input type="hidden" id="storeId" name="storeId" value="${storeAndUser.storeId!}">
						<input type="hidden" id="userId" name="userId" value="${storeAndUser.userId!}">
					</div>
				</div>
			</div>
			<div class="row">
				<div class="form-group form-group-lg">
					<div class="col-sm-2">
						<label class="control-label">商家名称</label>
					</div>
					<div class="col-sm-10">
						<input id="name" name="name" class="form-control" type="text" value="${storeAndUser.name!}">
					</div>
				</div>
			</div>
			<div class="row">
				<div class="form-group form-group-lg">
					<div class="col-sm-2">
						<label class="control-label">座机电话</label>
					</div>
					<div class="col-sm-10">
						<input id="landline" name="landline" success="true" class="form-control valueInput" type="text" value="${storeAndUser.landline!}">
						<span class="text-warning hide">电话格式有误</span>
					</div>
				</div>
			</div>
			<div class="row">
				<div class="form-group form-group-lg">
					<div class="col-sm-2">
						<label class="control-label">商家邮箱地址</label>
					</div>
					<div class="col-sm-10">
						<input id="email" name="email" class="form-control" type="text" value="${storeAndUser.email!}">
						<span class="text-warning hide">邮箱已存在或者格式错误</span>
					</div>
				</div>
			</div>
			<div class="row">
				<div class="form-group form-group-lg">
					<div class="col-sm-2">
						<label class="control-label">商家所在省/直辖市</label>
					</div>
					<div class="col-sm-10">
						<input id="provincial" name="provincial" class="form-control" type="text" value="${storeAndUser.provincial!}">
					</div>
				</div>
			</div>
			<div class="row">
				<div class="form-group form-group-lg">
					<div class="col-sm-2">
						<label class="control-label">商家所在城市</label>
					</div>
					<div class="col-sm-10">
						<input id="city" name="city" class="form-control" type="text" value="${storeAndUser.city!}">
					</div>
				</div>
			</div>
			<div class="row">
				<div class="form-group form-group-lg">
					<div class="col-sm-2">
						<label class="control-label">商家所在区/县</label>
					</div>
					<div class="col-sm-10">
						<input id="area" name="area" class="form-control" type="text" value="${storeAndUser.area!}">
					</div>
				</div>
			</div>
			<div class="row">
				<div class="form-group form-group-lg">
					<div class="col-sm-2">
						<label class="control-label">商家地址</label>
					</div>
					<div class="col-sm-7">
						<input id="address" name="address" class="form-control" type="text" value="${storeAndUser.address!}">
					</div>
					<div class="col-sm-3">
						<h5>请填写街道信息</h5>
					</div>
				</div>
			</div>
			<div class="row">
				<div class="form-group form-group-lg">
					<div class="col-sm-2">
						<label class="control-label">商家中文简介</label>
					</div>
					<div class="col-sm-10">
						<textarea id="chineseAbout" name="chineseAbout" class="form-control" rows="6">${storeAndUser.chineseAbout!}</textarea>
					</div>
				</div>
			</div>
			<div class="row">
				<div class="form-group form-group-lg">
					<div class="col-sm-2">
						<label class="control-label">商家英文简介</label>
					</div>
					<div class="col-sm-10">
						<textarea id="englishAbout" name="englishAbout" class="form-control" rows="6">${storeAndUser.englishAbout!}</textarea>
					</div>
				</div>
			</div>
			<div class="row">
				<div class="form-group form-group-lg">
					<div class="col-sm-2">
						<label class="control-label">商家网址</label>
					</div>
					<div class="col-sm-10">
						<div class="input-group">
							<span class="input-group-addon">http://</span> <input
								id="storeUrl" name="storeUrl" class="form-control" type="text"
								value="${storeAndUser.storeUrl!}">
						</div>
					</div>
				</div>
			</div>
			<div class="row">
				<div class="form-group form-group-lg">
					<div class="col-sm-2">
						<label class="control-label">营业执照</label>
					</div>
					<div class="col-sm-10">
						<input type="file" id="input-file-now" id="file" name="file" class="dropify" data-default-file="${ctxPath}/${storeAndUser.licenseImageUrl!}" />
					</div>
				</div>
			</div>
			<div class="row">
				<div class="form-group form-group-lg">
					<div class="col-sm-2">
						<label class="control-label">种子用户</label>
					</div>
					<div class="col-sm-1">
						<input id="check_isSeedUser" name="check_isSeedUser" class="form-control" type="checkbox">
					<input id="isSeedUser" name="isSeedUser" type="hidden" value="${storeAndUser.isSeedUser}">
					</div>
				</div>
			</div>
			<div class="row">
				<div class="form-group form-group-lg">
					<div class="col-sm-12 text-right">
						<button type="submit" class="btn btn-success btn-lg">提交</button>
					</div>
				</div>
			</div>
		</form>
	</div>
</div>
<%}%>
<script type="text/javascript">
$(function(){
	
	var drEvent = $('.dropify').dropify();
	drEvent.on('dropify.afterClear', function(event, element){
		deleteLogo();
	})
	
	var verdict={
			errInput : function(_this){
				_this.closest('.form-group').addClass('has-warning');
				_this.attr("success","false");
			},
			sucInput : function(_this){
				_this.closest('.form-group').removeClass('has-warning');
				_this.attr("success","true");
			}
	}
	
	var isSeedUser = '${storeAndUser.isSeedUser}';
	if(isSeedUser=='0'){
		$("input[name='check_isSeedUser']").prop("checked","true");
		}
	/*验证邮箱
	*/
	$("#email").blur(function() {
		var _this = $(this);
		var email_name = $.trim($("#email").val());
		var re = /^\w[-\w.+]*@.+(com|cn)$/;
		if (email_name != "") {
			if (re.test(email_name)) {
				$.ajax({
					type : 'get',
					dataType : "json",
					data : "email=" + email_name,
					url : '${ctxPath}/verifyEmail',
					success : function(ajaxResponse) {
						if (ajaxResponse.success == true) {
							verdict.sucInput($("#email"));
						} else {
							verdict.errInput($("#email"));
						}
					},
					error : function(jqXHR, textStatus, errorThrown) {
					}
				});
			} else {
				verdict.errInput($("#email"));
			}
		} else {
			verdict.sucInput($("#email"));
		}
	});
	
})

</script>